{% load cms_tags sekizai_tags i18n %}

<section
  class="about-cards-section"
  data-about-root
  data-layout="{{ layout_variant }}"
>
  {% if instance.title %}
    <header class="about-cards-section__header">
      <h2 class="about-cards-section__title">{{ instance.title }}</h2>
    </header>
  {% endif %}

  <div class="about-cards-section__body">
    {% if children %}
      {% for plugin in children %}
        {% render_plugin plugin %}
      {% endfor %}
    {% else %}
      <p class="about-cards-section__empty">
        {% trans "No descriptions added yet." %}
      </p>
    {% endif %}
  </div>
</section>

{% addtoblock "css" %}
<style>
  .about-cards-section {
    padding: clamp(1.5rem, 3vw, 2.5rem);
    background: var(--bs-body-bg, #fff);
    border-radius: 1rem;
    border: 1px solid rgba(33, 37, 41, 0.08);
    box-shadow: 0 1.2rem 2.5rem rgba(15, 23, 42, 0.08);
  }
  .about-cards-section__header {
    margin-bottom: clamp(1.25rem, 2.5vw, 1.8rem);
    text-align: center;
  }
  .about-cards-section__title {
    margin: 0;
    font-size: clamp(1.6rem, 3vw, 2.1rem);
    font-weight: 700;
    position: relative;
    display: inline-block;
    padding-bottom: 0.65rem;
  }
  .about-cards-section__title::after {
    content: "";
    position: absolute;
    left: 50%;
    bottom: 0;
    width: 72px;
    height: 3px;
    background: rgba(13, 110, 253, 0.25);
    transform: translateX(-50%);
    border-radius: 999px;
  }
  .about-cards-section__body {
    display: flex;
    flex-direction: column;
    gap: clamp(1rem, 2vw, 1.25rem);
  }
  .about-cards-section__empty {
    margin: 0;
    color: rgba(33, 37, 41, 0.6);
    font-style: italic;
    text-align: center;
  }
</style>
{% endaddtoblock %}

{% addtoblock "js" %}
<script>
  (function () {
    function scrollCardIntoView(element) {
      if (!element) return;
      var rect = element.getBoundingClientRect();
      var header = document.querySelector("#header");
      var headerOffset = header ? header.offsetHeight : 0;
      var offset = headerOffset + 16;
      var isFullyVisible = rect.top >= offset && rect.bottom <= window.innerHeight;
      if (isFullyVisible) {
        return;
      }
      var targetY = rect.top + window.scrollY - offset;
      window.requestAnimationFrame(function () {
        window.scrollTo({
          top: Math.max(targetY, 0),
          behavior: "smooth",
        });
      });
    }

    function toggleCard(control, expand, root) {
      var targetId = control.getAttribute("data-target");
      if (!targetId) return;
      var panel = document.getElementById(targetId);
      if (!panel) return;
      var isExpanded = expand !== undefined ? expand : control.getAttribute("aria-expanded") === "true";
      var nextState = expand !== undefined ? expand : !isExpanded;
      if (nextState && root) {
        root.querySelectorAll("[data-about-header]").forEach(function (otherControl) {
          if (otherControl === control) return;
          var otherPanelId = otherControl.getAttribute("data-target");
          var otherPanel = document.getElementById(otherPanelId);
          otherControl.setAttribute("aria-expanded", "false");
          if (otherPanel) {
            otherPanel.hidden = true;
          }
        });
      }
      control.setAttribute("aria-expanded", String(nextState));
      panel.hidden = !nextState;
      if (nextState) {
        scrollCardIntoView(control);
      }
      return nextState;
    }

    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll("[data-about-root]").forEach(function (root) {
        var layout = root.dataset.layout || "list";
        if (layout !== "accordion") {
          return;
        }
        root.querySelectorAll("[data-about-header]").forEach(function (header) {
          var handler = function () {
            var expanded = toggleCard(header, undefined, root);
            if (!expanded) {
              header.blur();
            }
          };
          header.addEventListener("click", handler);
          header.addEventListener("keydown", function (event) {
            if (event.key === "Enter" || event.key === " ") {
              event.preventDefault();
              handler();
            }
          });
          var card = header.closest("[data-about-card]");
          if (card) {
            card.addEventListener("click", function (event) {
              if (event.target.closest("[data-about-header]")) {
                return;
              }
              if (event.target.closest(".about-card__body")) {
                return;
              }
              if (event.target.closest("a, button, input, textarea, select, label")) {
                return;
              }
              if (window.getSelection && window.getSelection().toString()) {
                return;
              }
              handler();
            });
          }

          var body = document.getElementById(header.getAttribute("data-target"));
          if (body && body.dataset.initiallyExpanded === "true") {
            toggleCard(header, true, root);
          } else if (body) {
            body.hidden = true;
          }
        });
      });
    });
  })();
</script>
{% endaddtoblock %}
